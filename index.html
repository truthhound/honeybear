<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Minion asks: Be My Valentine?! üçåüíõ</title>
  <style>
    :root{
      --bg-1: #fff176;
      --bg-2: #ffe082;
      --accent: #000;
      --radius: 20px;
      --button-border: 8px;
      --shadow: 0 12px 50px rgba(0,0,0,0.35);
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }

    /* Mobile-first */
    html,body{
      height:100%;
      margin:0;
      padding: max(12px, var(--safe-top)) 12px max(16px, var(--safe-bottom));
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background: linear-gradient(135deg, var(--bg-1), var(--bg-2));
      font-family: "Comic Sans MS", "Comic Neue", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      color:#212121;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      gap:18px;
      min-height:100vh;
      box-sizing:border-box;
      transition: background 1s ease;
      overflow-x:hidden;
    }

    /* Title scales nicely on different screens */
    h1{
      margin: 6px 0 8px;
      font-weight:800;
      text-align:center;
      line-height:1.05;
      color:var(--accent);
      -webkit-text-stroke: 0.5px #fff;
      text-shadow: 4px 4px 0 #fff, 6px 6px 0 #000;
      font-size: clamp(1.6rem, 6vw, 3.2rem);
      transform-origin:center;
      animation: wiggle 2s infinite;
      padding: 2px 8px;
    }

    .container{
      width:100%;
      max-width:520px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:16px;
    }

    .media-card{
      width:100%;
      background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.35));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:10px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }

    img.minion-img, .gif-wrap, .dance-vid-container{
      width:100%;
      display:block;
      border-radius: 14px;
      max-height: 60vh;
      object-fit:cover;
      box-shadow: 0 12px 40px rgba(0,0,0,0.35);
    }

    /* Responsive iframe wrapper keeping aspect ratio */
    .gif-wrap{
      position:relative;
      padding-bottom:56.25%;
      height:0;
    }
    .gif-wrap iframe{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      border:0;
      display:block;
    }

    .dance-vid-container{
      display:none; /* shown when YES clicked */
      aspect-ratio: 3/4;
      max-width:420px;
    }

    /* Buttons: stacked on small, side-by-side on larger */
    .buttons{
      width:100%;
      max-width:520px;
      display:flex;
      gap:12px;
      justify-content:center;
      align-items:center;
      flex-wrap:wrap;
      margin-top:4px;
    }

    .buttons button{
      flex: 1 1 100%;
      min-width:160px;
      padding: 16px 12px;
      border-radius: 999px;
      border: var(--button-border) solid #000;
      font-size: clamp(1.05rem, 4vw, 1.4rem);
      font-weight:800;
      box-shadow: 0 10px 0 #000;
      cursor:pointer;
      touch-action: manipulation;
      transition: transform .18s ease, box-shadow .18s ease, opacity .2s ease;
    }

    .buttons button:active{ transform: translateY(2px) scale(0.995); box-shadow:0 6px 0 #000; }

    #yes{
      background: linear-gradient(180deg,#66bb6a,#43a047);
      color:white;
    }
    #no{
      background: linear-gradient(180deg,#ef5350,#e53935);
      color:white;
    }

    /* Larger screens: place buttons side-by-side */
    @media (min-width:640px){
      .buttons button{ flex:1 1 48%; min-width:180px; padding:18px 24px; font-size:1.35rem;}
      h1{font-size: clamp(2.2rem, 5vw, 4.5rem);}
      .container{gap:22px;}
    }

    /* Confetti canvas sits on top, but is pointer-events: none */
    #confetti-canvas{
      position:fixed;
      inset:0;
      width:100vw;
      height:100vh;
      pointer-events:none;
      z-index:999;
      mix-blend-mode: normal;
    }

    @keyframes wiggle {
      0%,100% { transform: rotate(-6deg); }
      50%     { transform: rotate(6deg); }
    }

    /* Respect reduce motion preference */
    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; transition: none !important; }
      #confetti-canvas{ display:none; }
    }

    /* Small utility */
    .sr-only{ position:absolute; left:-9999px; width:1px; height:1px; top:auto; overflow:hidden; }
  </style>
</head>
<body>

  <h1 id="title">WILL YOU BE<br>MY VALENTINE?! üçåü•∫üíï</h1>

  <div class="container" id="container">
    <div class="media-card" aria-hidden="false">
      <img id="minionGif" class="minion-img" alt="Happy Minion gif" loading="lazy"
        src="https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExYmpqMHNvMGk4ZmY3bWZpdXF4cHV5N2N4dnE5dnoxZWE1NnRzYWZrNCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/dL86xSgxaQSfvfTENV/giphy.gif">
    </div>

    <div class="media-card gif-wrap" id="extraGif" aria-hidden="true" style="display:block;">
      <iframe src="https://giphy.com/embed/aZ4sQUpybai5y" class="giphy-embed" allowFullScreen title="extra animated gif"></iframe>
    </div>

    <div class="media-card dance-vid-container" id="danceVid" aria-hidden="true">
      <iframe src="https://giphy.com/embed/bLr9BkqQTfv51XH7Ej" class="giphy-embed" allowFullScreen title="dance video"></iframe>
    </div>
  </div>

  <div class="buttons" id="buttons" role="group" aria-label="Valentine choices">
    <button id="yes" aria-label="Yes, I'll be your valentine!">YES BANANA!! üíõü•≥</button>
    <button id="no" aria-label="No, I won't">NO üò≠</button>
  </div>

  <canvas id="confetti-canvas" aria-hidden="true"></canvas>

  <script>
    // Elements
    const title = document.getElementById('title');
    const yesBtn = document.getElementById('yes');
    const noBtn  = document.getElementById('no');
    const minionGif = document.getElementById('minionGif');
    const extraGif = document.getElementById('extraGif');
    const danceVid = document.getElementById('danceVid');
    const buttonsDiv = document.getElementById('buttons');
    const canvas = document.getElementById('confetti-canvas');
    const ctx = canvas.getContext ? canvas.getContext('2d') : null;

    // Responsive particle count: fewer on small screens for performance
    function recommendedParticleCount() {
      const w = Math.min(window.innerWidth, 900);
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return 0;
      if (w < 420) return 70;
      if (w < 720) return 120;
      return 180;
    }

    let particles = [];
    let animating = true;
    let rafId = null;

    // Setup canvas size
    function resizeCanvas() {
      canvas.width = window.innerWidth * devicePixelRatio;
      canvas.height = window.innerHeight * devicePixelRatio;
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
      if (ctx) ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
    }
    resizeCanvas();
    window.addEventListener('resize', () => {
      resizeCanvas();
      // adjust particle count when screen size changes
      createParticles();
    });
    window.addEventListener('orientationchange', () => setTimeout(resizeCanvas, 300));

    // Particle class optimized for mobile
    class Particle {
      constructor() { this.reset(true); }
      reset(init=false) {
        const W = window.innerWidth, H = window.innerHeight;
        this.x = Math.random() * W;
        this.y = (init ? Math.random()*H : -10 - Math.random()*200);
        this.size = Math.random() * 8 + 3;
        const baseSpeed = (W < 420) ? 3 : 5;
        this.speedY = Math.random() * baseSpeed + (W < 420 ? 1.5 : 3);
        this.speedX = Math.random() * 6 - 3;
        this.rotation = Math.random() * 360;
        this.rotationSpeed = Math.random() * 8 - 4;
        this.color = `hsl(${Math.random() * 360}, 92%, ${Math.random()*20+40}%)`;
        this.opacity = Math.random() * 0.6 + 0.4;
      }
      update() {
        this.y += this.speedY;
        this.x += this.speedX;
        this.rotation += this.rotationSpeed;
        this.opacity -= 0.003;
        if (this.y > window.innerHeight + 40 || this.opacity <= 0 || this.x < -60 || this.x > window.innerWidth + 60) {
          this.reset(false);
        }
      }
      draw() {
        if (!ctx) return;
        ctx.save();
        ctx.globalAlpha = Math.max(0, this.opacity);
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation * Math.PI / 180);
        ctx.fillStyle = this.color;
        ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
        ctx.restore();
      }
    }

    function createParticles(){
      const desired = recommendedParticleCount();
      if (particles.length > desired) {
        particles = particles.slice(0, desired);
      } else {
        while (particles.length < desired) particles.push(new Particle());
      }
    }
    createParticles();

    // Animation loop - respects reduced motion & page visibility
    function animate() {
      if (!ctx) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let p of particles) { p.update(); p.draw(); }
      if (animating) rafId = requestAnimationFrame(animate);
    }
    // Start unless user prefers reduced motion
    if (!window.matchMedia || !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      animate();
    }

    // Pause animation when page not visible to save CPU / battery
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        animating = false;
        if (rafId) cancelAnimationFrame(rafId);
      } else {
        if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
          animating = true;
          animate();
        }
      }
    });

    // NO button: run away but keep movement within viewport safe bounds
    function moveNoButtonRandomly() {
      const btnRect = noBtn.getBoundingClientRect();
      const parentRect = buttonsDiv.getBoundingClientRect();
      const vw = window.innerWidth;
      const vh = window.innerHeight;
      // compute a new center position inside visible area (keeping button fully visible)
      const maxLeft = Math.max(8, vw - btnRect.width - 8);
      const maxTop = Math.max(8, vh - btnRect.height - 120);
      const newLeft = Math.random() * (maxLeft - 8) + 8;
      const newTop  = Math.random() * (maxTop - 8) + 8;
      // use transform with translate to avoid layout reflow; set position fixed for the escape
      noBtn.style.position = 'fixed';
      noBtn.style.left = `${newLeft}px`;
      // keep above bottom safe area
      noBtn.style.top = `${newTop}px`;
      noBtn.style.transform = `scale(0.95) rotate(${Math.random()*30-15}deg)`;
      noBtn.style.transition = 'transform .28s ease, left .28s ease, top .28s ease';
      // temporary playful label changes
      const texts = ['PLEEEEASE? ü•∫','NOOO DON\'T üò≠üçå','PRETTY PLEASE???','MINION SAD üíî'];
      noBtn.textContent = texts[Math.floor(Math.random()*texts.length)];
      setTimeout(()=> {
        noBtn.textContent = "NO üò≠";
        // after some time, snap back to normal layout (relative) to work with responsive layouts
        setTimeout(()=> {
          noBtn.style.position = '';
          noBtn.style.left = '';
          noBtn.style.top = '';
          noBtn.style.transform = '';
          noBtn.style.transition = '';
        }, 1200);
      }, 1100);
    }

    noBtn.addEventListener('click', (e) => {
      e.preventDefault();
      moveNoButtonRandomly();
    }, {passive:true});

    // Also make it respond to touchstart for immediate reaction on phones
    noBtn.addEventListener('touchstart', (e) => {
      // small delay to allow click fallback
      e.preventDefault();
      moveNoButtonRandomly();
    }, {passive:false});

    // YES button behavior: quick celebration, show dance video, big confetti burst
    yesBtn.addEventListener('click', () => {
      // change background palette
      document.body.style.background = "linear-gradient(135deg, #ffeb3b, #ff5722, #e91e63, #9c27b0)";
      title.textContent = "YAY!! YOU'RE MY VALENTINE!! ü•≥üíõüíï";

      // Hide media and controls gracefully
      minionGif.style.transition = 'opacity .5s ease';
      extraGif.style.transition = 'opacity .5s ease';
      buttonsDiv.style.transition = 'opacity .5s ease, transform .4s ease';
      minionGif.style.opacity = '0';
      extraGif.style.opacity = '0';
      buttonsDiv.style.opacity = '0';
      buttonsDiv.style.transform = 'translateY(10px) scale(.98)';

      setTimeout(()=>{
        minionGif.style.display = 'none';
        extraGif.style.display = 'none';
        buttonsDiv.style.display = 'none';
      }, 600);

      // Show dance video
      danceVid.style.display = 'block';
      danceVid.style.opacity = '0';
      danceVid.style.transition = 'opacity .9s ease';
      setTimeout(()=> danceVid.style.opacity = '1', 80);

      // Big confetti burst: temporarily increase particle speed and opacity
      for (let i = 0; i < particles.length; i++) {
        setTimeout(() => {
          particles[i].y = -Math.random() * 300;
          particles[i].opacity = 1;
          particles[i].speedY = Math.random() * 9 + 6;
          particles[i].speedX = Math.random() * 8 - 4;
        }, i * 6);
      }

      // minor haptic feedback on supporting devices
      if (navigator.vibrate) navigator.vibrate([20,30,20]);
    }, {passive:true});

    // Improve accessibility: keyboard handlers
    yesBtn.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') yesBtn.click(); });
    noBtn.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') noBtn.click(); });

    // initial visual adjustments for small screens
    (function init() {
      // On small devices, reduce particle count for battery
      createParticles();
      // if reduced motion, stop animating canvas
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        canvas.style.display = 'none';
      }
      // keep layout tidy: ensure buttons are visible on small screens
      window.setTimeout(()=>{ window.scrollTo({top:0,behavior:'smooth'}); }, 120);
    })();

  </script>

</body>
</html>
